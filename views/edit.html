<!DOCTYPE html>
<html>

<head>
  ${head}
  <link crossorigin="anonymous" rel="stylesheet" href="https://unpkg.com/easymde/dist/easymde.min.css" />
  <script crossorigin="anonymous" src="https://unpkg.com/easymde/dist/easymde.min.js"></script>
  <style>
    form,
    fieldset {
      display: flex;
      flex-direction: column;
    }

    .visibilityLabel {
      text-transform: capitalize;
    }

    header {
      display: flex;
      justify-content: space-between;
    }

    .editor-toolbar button,
    .editor-toolbar.fullscreen button {
      color: initial;
    }

    .editor-toolbar button:hover,
    .editor-toolbar.fullscreen button:hover {
      color: initial;
    }

    .editor-toolbar button.active,
    .editor-toolbar button:hover {
      background-color: #982c61 !important;
      color: white !important;
    }

    input:not([type='radio']) {
      width: 100%;
    }

    .deleteArticle {
      padding-top: 1.5em;
      margin-top: 1.5em;
      border-top: 0.25ch dashed black;
    }

    @media(prefers-color-scheme: dark) {
      .deleteArticle {
        border-top: 0.25ch dashed white;
      }

      .saveButton {
        width: 100%;
      }

      [role=alert] {
        background-color: #A5243D;
        padding: 0.5em;
        border-radius: 4px;
        font-weight: bold;
      }

      .EasyMDEContainer,
      .editor-toolbar.fullscreen {
        background-color: #4a4a4a !important;
      }

      .CodeMirror,
      .editor-preview {
        color: #f9f9f9 !important;
        border-color: #4a4a4a !important;
        background-color: #222222 !important;
      }

      .cm-s-easymde .CodeMirror-cursor {
        border-color: #f9f9f9 !important;
      }

      .editor-toolbar {
        border-color: #4a4a4a !important;
      }

      .editor-toolbar button i {
        color: #f9f9f9 !important;
      }

      .editor-toolbar button.active,
      .editor-toolbar button:hover {
        background-color: #2c8898 !important;
      }

      .editor-preview pre,
      .cm-comment {
        background-color: #4a4a4a !important;
      }
    }
  </style>
</head>

<body>
  <header>
    <h2>Editing ${title}</h2>
    <nav>
      ${isNew
      ? `<a href="/">Cancel</a>`
      : `<a href="/@${authorDisplayId}/${displayId}">Cancel</a>`
      }
    </nav>
  </header>
  <main>
    ${errorMessage}
    <form action="/@${authorDisplayId}/${displayId}/edit" method="post">
      <label>Title <small>(Required)</small><input type="text" name="title" value="${title}" maxlength="280"
          required /></label>
      <label>Summary <small>(Leave Blank for Automatic Summary)</small> <input name="summary" type="text"
          value="${summary}" maxlength="280" /></label>
      <label>Article</label>
      <textarea name="article" maxlength="16000000">${rawContent}</textarea>
      <button class="saveButton">Save</button>
      <details>
        ${isNew
        ? `<summary>Advanced Settings (URL Endpoint, Visibility)</summary>`
        : `<summary>Advanced Settings (URL Endpoint, Visibility, Deletion)</summary>`
        }
        <label>URL Endpoint
          <small>(Required, Must be Unique, No Spaces, Alphanumeric characters Only)</small>
          <input type="text" name="displayId" value="${displayId}" maxlength="191" required />
        </label>
        <fieldset>
          <legend>Visibility</legend>
          ${['private', 'unlisted', 'public'].map((curr)=>/*html*/`<label class="visibilityLabel">
            <input type="radio" name="visibility" value="${curr}" ${visibility===curr ?'checked':''} />
            ${curr}
          </label>`).join('\n')}
        </fieldset>
        <button class="saveButton">Save</button>
        <input type="hidden" name="_csrf" value="${csrf}" />
        <input type="hidden" name="isNew" value="${isNew}" />
    </form>
    ${isNew ? '' :
    `<form action="/@${authorDisplayId}/${displayId}/delete" method="post" class="deleteArticle">
      <fieldset>
        <legend>
          Delete Article
        </legend>
        <label>
          Please Enter ${displayId} to Confirm
          <input type="text" name="deleteMe" />
        </label>
      </fieldset>
      <button>Delete</button>
      <input type="hidden" name="_csrf" value="${csrf}" />
    </form>`
    }
    </details>
  </main>
</body>
<script>
  const easyMDE = new EasyMDE({
    autofocus: true,
    autosave: {
      enabled: true,
      uniqueId: '${displayId}',
      text: 'Last saved locally at '
    }
  })
</script>

</html>